import java.awt.Dimension;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTabbedPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.SwingUtilities;

@SuppressWarnings("serial")
public class MyFrame extends JFrame {
	int id = -1;
	//Създаване на общ панел с 5 таба 
	JTabbedPane tabbedPane=new JTabbedPane();
	JPanel tab1=new JPanel();
	JPanel tab2=new JPanel();
	JPanel tab3=new JPanel();
	JPanel tab4=new JPanel();
	JPanel tab5=new JPanel();
	
	//sql commands
	PreparedStatement state=null;
    Connection conn=null;
    
    //таблица за визуализиране на данните от базата данни
    //JTable([n],[r][n]) ....... [n]данни за въвеждане .... [r][n]визуализация на данни
    JTable table=new JTable();
    JTable table2=new JTable();
    JTable table3=new JTable();
    JTable table4=new JTable();
    JTable table5=new JTable();
    
    //скролиране на таблицата нагоре надолу наляво надясно
    JScrollPane scroller=new JScrollPane(table);
    JScrollPane scroller2=new JScrollPane(table2);
    JScrollPane scroller3=new JScrollPane(table3);
    JScrollPane scroller4=new JScrollPane(table4);
    JScrollPane scroller5=new JScrollPane(table5);
    
	//Създаваме панелите за разграфяване на програмните елементи
    //за таблица 1
	JPanel upPanel=new JPanel();
	JPanel midPanel=new JPanel();
	JPanel downPanel=new JPanel();
	//за таблица 2
	JPanel upPanel2=new JPanel();
	JPanel midPanel2=new JPanel();
	JPanel downPanel2=new JPanel();
	//за таблица 3
	JPanel upPanel3=new JPanel();
	JPanel midPanel3=new JPanel();
	JPanel downPanel3=new JPanel();	
	//за таблица 4
	JPanel upPanel4=new JPanel();
	JPanel midPanel4=new JPanel();
	JPanel downPanel4=new JPanel();
	//за таблица 5
	JPanel upPanel5=new JPanel();
	JPanel midPanel5=new JPanel();
	JPanel downPanel5=new JPanel();
		
	//.............................................................................................................................
	//Създаваме етикети за таблица 1
	JLabel fnameLabel=new JLabel("Име:");
	JLabel lnameLabel=new JLabel("Фамилия:");
	JLabel addressLabel=new JLabel("Адрес:");
	//..............................................................................................................................
	//Създаваме текстови полета за таблица 1
	JTextField fnameTField=new JTextField();
	JTextField lnameTField=new JTextField();
	JTextField addressTField=new JTextField();
	//...............................................................................................................................
	//Добавяме бутони за add edit  за таблица 1
	JButton addBtn=new JButton("Добавяне");
	JButton updBtn=new JButton("Редактиране");
	
	
	
	//.............................................................................................................................
    //Създаваме етикети за таблица 2
	JLabel titleLabel=new JLabel("Заглавие на филма:");
	JLabel createdLabel=new JLabel("Дата на създаване:");
	//..............................................................................................................................
    //Създаваме текстови полета за таблица 2
	JTextField titleTField=new JTextField();	
	JTextField createdTField = new JTextField();
	//..............................................................................................................................
	//Добавяме бутони за add edit  за таблица 2
	JButton addBtn2=new JButton("Добавяне");
	JButton updBtn2=new JButton("Редактиране");
	
		
	
	//.............................................................................................................................
    //Създаваме етикети за таблица 3
	JLabel dateOfRentLabel=new JLabel("Дата за присъстване в кино залата:");
	JLabel priceLabel=new JLabel("Такса за билет:");
	//..............................................................................................................................
    //Създаваме текстови полета за таблица 3
	JTextField dateOfRentTField=new JTextField();	
	JTextField priceTField = new JTextField();
	//..............................................................................................................................
	//Добавяме бутони за add edit delete за таблица 3
	JButton addBtn3=new JButton("Добавяне");
	JButton updBtn3=new JButton("Редактиране");
	JButton delBtn3=new JButton("Изтриване");
		
  public MyFrame() {
	  
	// Добавяме разграфените табове с тяхните имена
    this.add(tabbedPane);
    tabbedPane.add(tab1,"Clients");
	tabbedPane.add(tab2,"Media");
	tabbedPane.add(tab3,"Clients_Media");
	tabbedPane.add(tab4,"SearchQuery1");
	tabbedPane.add(tab5,"SearchQuery2");
	
	//указва на прозореца на програмата да се покаже
	this.setVisible(true);
	//указва размерът на прозореца при показване широчина и дължина
	this.setSize(850, 800);
	//указва на програмата да приключи след спиране на изпълнението и
	this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
	
	//Добавя в изгледа разпределението на елементите
	//таблица1+панел1
	tab1.setLayout(new GridLayout(3,1));	
	tab1.add(upPanel);
	tab1.add(midPanel);
	tab1.add(downPanel);
	
	upPanel.setLayout(new GridLayout(3,2));  
	upPanel.add(fnameLabel); //етикет +
	upPanel.add(fnameTField);//текстово поле се взимат за 1 ред 
	upPanel.add(lnameLabel); 
	upPanel.add(lnameTField);//2ри ред 
	upPanel.add(addressLabel);
    upPanel.add(addressTField);//3ти ред  
    
    addBtn.addActionListener(new AddAction());
    midPanel.add(addBtn);
	midPanel.add(updBtn);

	//таблица2+панел2
	tab2.setLayout(new GridLayout(3,1));	
	tab2.add(upPanel2);
	tab2.add(midPanel2);
	tab2.add(downPanel2);
	
    upPanel2.setLayout(new GridLayout(3,2)); 
    upPanel2.add(titleLabel);
    upPanel2.add(titleTField);//1ви ред
    upPanel2.add(createdLabel);
    upPanel2.add(createdTField);//2ри ред

	addBtn2.addActionListener(new AddAction());
	midPanel2.add(addBtn2);
	midPanel2.add(updBtn2);

	
	//таблица3+панел3
		tab3.setLayout(new GridLayout(3,1));	
		tab3.add(upPanel3);
		tab3.add(midPanel3);
		tab3.add(downPanel3);
		
	    upPanel3.setLayout(new GridLayout(3,2)); 
	    upPanel3.add(dateOfRentLabel);
	    upPanel3.add(dateOfRentTField);//1ви ред
	    upPanel3.add(priceLabel);
	    upPanel3.add(priceTField);//2ри ред

		addBtn3.addActionListener(new AddAction());
		midPanel3.add(addBtn3);
		midPanel3.add(updBtn3);
		midPanel3.add(delBtn3);
		
	//таблица4+панел4
	tab4.setLayout(new GridLayout(3,1));	
	tab4.add(upPanel4);
	tab4.add(midPanel4);
	tab4.add(downPanel4);
	
	//таблица5+панел5
	tab5.setLayout(new GridLayout(3,1));	
	tab5.add(upPanel5);
	tab5.add(midPanel5);
	tab5.add(downPanel5);

	//добавяне на таблиците със скролерите
	table.setModel(DBConnector.selectAll("clients"));
	table2.setModel(DBConnector.selectAll("media"));
	table3.setModel(DBConnector.selectAll("clients_media"));
	
	scroller.setPreferredSize(new Dimension(600,200)); 
	downPanel.add(scroller);       	       
	scroller2.setPreferredSize(new Dimension(600,200)); 
	downPanel2.add(scroller2);
	scroller3.setPreferredSize(new Dimension(600,200)); 
	downPanel3.add(scroller3);
	scroller4.setPreferredSize(new Dimension(600,200)); 
	downPanel4.add(scroller4);
	scroller5.setPreferredSize(new Dimension(600,200)); 
	downPanel5.add(scroller5);
}
  
  //методи - add/edit/delete на 3те таблици
  
 //метод за добавяне
  class AddAction implements ActionListener{
	  
	@Override
	public void actionPerformed(ActionEvent e) {
	   //метода за добавяне приема всички полета
	   String fname=fnameTField.getText();
	   String lname=lnameTField.getText();
	   String adrname=addressTField.getText();
	   String title=titleTField.getText();
	   String created=createdTField.getText();
	   String dateOfRent=dateOfRentTField.getText();
	   String price=priceTField.getText();
	
	    //добавяне на данни в таблица clients в базата данни
	   String sql="insert into CLIENTS values(null,?,?,?);";
	   conn=DBConnector.getConnection();
			try {
			     state=conn.prepareStatement(sql);
				 state.setString(1,fname);
				 state.setString(2,lname);
				 state.setString(3,adrname);	
				 state.execute();
				 
				 table.setModel(DBConnector.selectAll("clients"));
				 clearForm();
			} catch (SQLException e1) {
			  e1.printStackTrace();
			}
		//добавяне на данни в таблица media в базата данни
			String sql2="insert into MEDIA values(null,?,?);";
			   conn=DBConnector.getConnection();
					try {
					     state=conn.prepareStatement(sql2);
						 state.setString(1,title);
						 state.setString(2,created);
						 state.execute();
						 
						 table2.setModel(DBConnector.selectAll("media"));
						 clearForm2();
					} catch (SQLException e1) {
					  e1.printStackTrace();
					}
					//добавяне на данни в таблица clients_media в базата данни
					String sql3="insert into CLIENTS_MEDIA values(null,?,?);";
					   conn=DBConnector.getConnection();
							try {
							     state=conn.prepareStatement(sql3);
								 state.setString(1,dateOfRent);
								 state.setString(2,price);
								 state.execute();
								 
								 table2.setModel(DBConnector.selectAll("clients_media"));
								 clearForm3();
							} catch (SQLException e1) {
							  e1.printStackTrace();
							}
							
	      }
	 //изчистване на формите
	  public void clearForm()
	  {
		fnameTField.setText("");
		lnameTField.setText("");
		addressTField.setText("");
	  }	
	  
	  public void clearForm2()
	  {
		titleTField.setText("");
		createdTField.setText("");		
	  }	
	  
	  public void clearForm3()
	  {
		dateOfRentTField.setText("");
		priceTField.setText("");		
	  }	
   }
  //метод за редактиране
  class EditAction implements ActionListener{

		@Override
		public void actionPerformed(ActionEvent e) {
		   //метода за редактиране приема всички полета
		   String fname=fnameTField.getText();
		   String lname=lnameTField.getText();
		   String adrname=addressTField.getText();
		   String title=titleTField.getText();
		   String created=createdTField.getText();
		   String dateOfRent=dateOfRentTField.getText();
		   String price=priceTField.getText();
		
		   //редактиране на данни в таблица clients в базата данни
		   String sql="update CLIENTS set values(null,?,?,?);";
		   conn=DBConnector.getConnection();
				try {
				     state=conn.prepareStatement(sql);
					 state.setString(1,fname);
					 state.setString(2,lname);
					 state.setString(3,adrname);	
					 state.execute();
					 
					 DBConnector.updateRow("clients", id);
					 table.setModel(DBConnector.selectAll("clients"));
					 clearForm();
				} catch (SQLException e1) {
				  e1.printStackTrace();
				}
			//редактиране на данни в таблица media в базата данни
				String sql2="update  MEDIA set values(null,?,?);";
				   conn=DBConnector.getConnection();
						try {
						     state=conn.prepareStatement(sql2);
							 state.setString(1,title);
							 state.setString(2,created);
							 state.execute();
							 
							 DBConnector.updateRow("media", id);
							 table.setModel(DBConnector.selectAll("clients"));
							 clearForm2();
						} catch (SQLException e1) {
						  e1.printStackTrace();
						}
			//редактиране на данни в таблица clients_media в базата данни
						String sql3="update CLIENTS_MEDIA set values(null,?,?);";
						   conn=DBConnector.getConnection();
								try {
								     state=conn.prepareStatement(sql3);
									 state.setString(1,dateOfRent);
									 state.setString(2,price);
									 state.execute();
									 
									 DBConnector.updateRow("clients_media", id);
									 table.setModel(DBConnector.selectAll("clients"));
									 clearForm3();
								} catch (SQLException e1) {
								  e1.printStackTrace();
								}
								
		      }
		 //изчистване на формите
		  public void clearForm()
		  {
			fnameTField.setText("");
			lnameTField.setText("");
			addressTField.setText("");
		  }	
		  
		  public void clearForm2()
		  {
			titleTField.setText("");
			createdTField.setText("");		
		  }	
		  
		  public void clearForm3()
		  {
			dateOfRentTField.setText("");
			priceTField.setText("");		
		  }	
		
	} 
  //метод при които при натискане на бутон от мишката да позволява изтриване на запис
  class TableMouseClick extends MouseAdapter{
		
		@Override
		public void mouseClicked(MouseEvent e) {
			//.........................................................................
			//редактиране на таблица1
			int row = table.getSelectedRow();
			Object value = table.getValueAt(row, 0);
			id = Integer.parseInt(value.toString());
			
			if(e.getClickCount() > 1) {
				fnameTField.setText(table.getValueAt(row, 1).toString());
				lnameTField.setText(table.getValueAt(row, 2).toString());
				addressTField.setText(table.getValueAt(row, 2).toString());
			}
			if(SwingUtilities.isRightMouseButton(e)) {
				MyPopUpMenu menu = new MyPopUpMenu(id);
				menu.show(table, e.getX(), e.getY());
			}
			//..........................................................................
			//редактиране на таблица 2
			int row2 = table2.getSelectedRow();
			Object value2 = table2.getValueAt(row2, 0);
			id = Integer.parseInt(value2.toString());
			
			if(e.getClickCount() > 1) {
				dateOfRentTField.setText(table2.getValueAt(row2, 1).toString());
				priceTField.setText(table2.getValueAt(row2, 2).toString());
				
			}
			
			if(SwingUtilities.isRightMouseButton(e)) {
				MyPopUpMenu menu = new MyPopUpMenu(id);
				menu.show(table2, e.getX(), e.getY());
			}
		    //..............................................................................
			//редактиране на таблица3
			int row3 = table3.getSelectedRow();
			Object value3 = table3.getValueAt(row3, 0);
			id = Integer.parseInt(value3.toString());
			
			if(e.getClickCount() > 1) {
				dateOfRentTField.setText(table3.getValueAt(row3, 1).toString());
				priceTField.setText(table3.getValueAt(row3, 2).toString());
				
			}
			
			if(SwingUtilities.isRightMouseButton(e)) {
				MyPopUpMenu menu = new MyPopUpMenu(id);
				menu.show(table3, e.getX(), e.getY());
			}
			
		}
		
	}

    //метод за изтриване
   class DeleteAction implements ActionListener{

		@Override
		public void actionPerformed(ActionEvent e) {
			
			DBConnector.deleteRow("clients_media", id);
			table3.setModel(DBConnector.selectAll("clients_media"));
			id = -1;			
		}
	}
}

